#! /usr/bin/env python3
"""Terminal execitions

Usage:
    termexec <cmdline> <expr>... [options]

Options:
    --user=<user>           Set remote user [default: termgr].
    --keyfile=<key_file>    Set private key file \
[default: /var/lib/nagios/.ssh/terminals].
    --help                  Show this page.
"""
from contextlib import suppress

from homeinfo.terminals.filter import TerminalFilter
from homeinfo.terminals.ctrl import RemoteController


if __name__ == '__main__':
    from docopt import docopt

    options = docopt(__doc__)

    user = options['--user']
    keyfile = options['--keyfile']

    for expr in options['<expr>']:
        for terminal in TerminalFilter(expr):
            rc = RemoteController(user, terminal, keyfile=keyfile)
            result = rc.execute(options['<cmdline>'])

            if result:
                with suppress(AttributeError):
                    print(result.stdout.decode())

                exit(0)
            else:
                print(result)
                exit(2)
